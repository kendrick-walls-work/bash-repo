language: generic
sudo: false

branches:
  only:
    - stable
    - master

addons:
  apt:
    packages:
      - libcurl4-openssl-dev
      - libelf-dev
      - libdw-dev
      - cmake

matrix:
  include:
  - os: linux
    addons:
      apt:
        packages:
          - libcurl4-openssl-dev
          - libelf-dev
          - libdw-dev
          - cmake
    language: generic
    dist: trusty
  - os: linux
    language: generic
    dist: precice
  - os: osx
    osx_image: xcode6.4
    language: generic
  - os: osx
    osx_image: xcode7.2
    language: generic
  - os: osx
    osx_image: xcode7.3
    language: generic
  - os: osx
    osx_image: xcode8
    language: generic
  - os: osx
    osx_image: xcode8.3
    language: generic

install:
  - make clean || true
  - make install 2>/dev/null || true

script:
  - make clean || true
  - make test

after_success:
  - if [[ $TRAVIS_OS_NAME == linux ]]; then curl --url="https://github.com/SimonKagstrom/kcov/archive/master.tar.gz" -o ./master.tar.gz 2>/dev/null 3>/dev/null &&\
  tar xzf master.tar.gz &&\
  cd kcov-master &&\
  mkdir build &&\
  cd build &&\
  cmake .. &&\
  make &&\
  sudo make install &&\
  cd ../.. &&\
  rm -rf kcov-master &&\
  mkdir -p coverage &&\
  kcov ./coverage make test &&\
  bash <(curl -s "https://codecov.io/bash") -s ./coverage ; fi
  - echo "Done."

